<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="ZNT -OPERACOES DO DIA" language="groovy" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20">
	<property name="ireport.zoom" value="1.948717100000002"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<property name="ireport.definition"/>
	<parameter name="P_REFERENCIA" class="java.sql.Timestamp"/>
	<parameter name="SUBREPORT_DIR" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["./"]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT *
FROM (
    SELECT
        BXA.SEQBAI,
        IBX.SEQITE,
        PRO.CODPROD || ' ' || PRO.DESCRPROD || ' ' || (
            SELECT MAX(V.DESCRDANFE)
            FROM TGFVOA V
            WHERE V.CODPROD = IBX.CODPROD
              AND V.CODVOL = PRO.CODVOL
        ) || ' - ' || PRO.MARCA AS PRODUTO,
        USU.CODUSU || ' - ' || USU.NOMEUSUCPLT AS USUARIO,
        TO_CHAR(BXA.DATGER, 'DD/MM/YYYY') AS REFERENCIA,
        TO_CHAR(BXA.DATGER, 'HH24:MI:SS') AS HORA,
        IBX.SEQEND,
        IBX.ENDDES,
        -- A MUDANÇA ESTÁ AQUI
        ROW_NUMBER() OVER (PARTITION BY BXA.SEQBAI ORDER BY IBX.SEQITE DESC) AS RN
    FROM AD_IBXEND IBX
    JOIN AD_BXAEND BXA ON BXA.SEQBAI = IBX.SEQBAI
    JOIN TGFPRO PRO ON PRO.CODPROD = IBX.CODPROD
    JOIN TSIUSU USU ON USU.CODUSU = BXA.USUGER
    WHERE TRUNC(BXA.DATGER) = TRUNC($P{P_REFERENCIA})
      AND BXA.BXAPRO = 'S'
      AND IBX.APP = 'S'
) t
WHERE t.RN = 1
ORDER BY t.SEQEND, t.ENDDES]]>
	</queryString>
	<field name="SEQBAI" class="java.math.BigDecimal"/>
	<field name="SEQITE" class="java.math.BigDecimal"/>
	<field name="PRODUTO" class="java.lang.String"/>
	<field name="USUARIO" class="java.lang.String"/>
	<field name="REFERENCIA" class="java.lang.String"/>
	<field name="HORA" class="java.lang.String"/>
	<field name="SEQEND" class="java.math.BigDecimal"/>
	<field name="ENDDES" class="java.math.BigDecimal"/>
	<field name="RN" class="java.math.BigDecimal"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<pageHeader>
		<band height="67" splitType="Stretch">
			<rectangle>
				<reportElement mode="Transparent" x="0" y="0" width="555" height="67"/>
			</rectangle>
			<staticText>
				<reportElement x="0" y="0" width="555" height="67"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="14" isBold="true"/>
				</textElement>
				<text><![CDATA[Baixas e Transferências do APP]]></text>
			</staticText>
			<textField>
				<reportElement x="445" y="0" width="108" height="13"/>
				<textElement textAlignment="Right">
					<font fontName="Arial" size="8" isBold="false"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[new java.text.SimpleDateFormat("dd/MM/yyyy HH:mm:ss").format(new java.util.Date())]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="445" y="54" width="108" height="13"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="Arial" size="8" isBold="false"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA["PAG.: " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="0" y="0" width="555" height="20"/>
				<textElement textAlignment="Center">
					<font fontName="Arial" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA["Referência: " + $F{REFERENCIA}]]></textFieldExpression>
			</textField>
		</band>
	</pageHeader>
	<detail>
		<band height="38" splitType="Stretch">
			<elementGroup>
				<textField>
					<reportElement mode="Opaque" x="0" y="0" width="56" height="15" backcolor="#CCCCCC"/>
					<box>
						<topPen lineWidth="1.0"/>
						<leftPen lineWidth="1.0"/>
						<bottomPen lineWidth="1.0"/>
						<rightPen lineWidth="1.0"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font fontName="SansSerif" isBold="true"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{SEQBAI}.toString()]]></textFieldExpression>
				</textField>
				<textField>
					<reportElement mode="Opaque" x="395" y="0" width="88" height="15" backcolor="#CCCCCC"/>
					<box>
						<pen lineWidth="1.0"/>
						<topPen lineWidth="1.0"/>
						<leftPen lineWidth="1.0"/>
						<bottomPen lineWidth="1.0"/>
						<rightPen lineWidth="1.0"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font fontName="SansSerif" isBold="true"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{USUARIO}.toString()]]></textFieldExpression>
				</textField>
				<textField>
					<reportElement mode="Opaque" x="483" y="0" width="72" height="15" backcolor="#CCCCCC"/>
					<box>
						<topPen lineWidth="1.0"/>
						<leftPen lineWidth="1.0"/>
						<bottomPen lineWidth="1.0"/>
						<rightPen lineWidth="1.0"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font fontName="SansSerif" isBold="true"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{HORA}.toString()]]></textFieldExpression>
				</textField>
				<textField>
					<reportElement mode="Opaque" x="56" y="0" width="339" height="15" backcolor="#CCCCCC"/>
					<box>
						<pen lineWidth="1.0"/>
						<topPen lineWidth="1.0"/>
						<leftPen lineWidth="1.0"/>
						<bottomPen lineWidth="1.0"/>
						<rightPen lineWidth="1.0"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font fontName="SansSerif" isBold="true"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[" " + $F{PRODUTO}]]></textFieldExpression>
				</textField>
			</elementGroup>
			<subreport>
				<reportElement key="ZNT_BXA_ITENS" x="0" y="15" width="575" height="15"/>
				<subreportParameter name="SUBREPORT_DIR">
					<subreportParameterExpression><![CDATA[$P{SUBREPORT_DIR}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="P_SEQBAI">
					<subreportParameterExpression><![CDATA[$F{SEQBAI}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression class="java.lang.String"><![CDATA[$P{SUBREPORT_DIR} + "ZNT_BXA_ITENS.jasper"]]></subreportExpression>
			</subreport>
		</band>
	</detail>
</jasperReport>
