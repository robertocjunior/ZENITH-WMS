!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();let e=null;const t=()=>localStorage.getItem("sessionToken"),n=e=>localStorage.setItem("sessionToken",e),a=()=>localStorage.removeItem("sessionToken"),i=()=>localStorage.getItem("username"),d=e=>localStorage.setItem("username",e),o=()=>localStorage.removeItem("username"),s=()=>localStorage.getItem("codusu"),c=e=>localStorage.setItem("codusu",e),l=()=>localStorage.removeItem("codusu"),r=()=>localStorage.getItem("deviceToken"),m=e=>localStorage.setItem("deviceToken",e);async function u(e,n={}){const a=t();if(!a)throw g(),new Error("Sessão inválida. Por favor, faça login novamente.");const i=await fetch(`/api${e}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(n)}),d=await i.json();if(!i.ok)throw 401!==i.status&&403!==i.status||g(!0),new Error(d.message||"Erro na comunicação com o servidor.");return d}async function v(){const e=document.getElementById("login-username"),t=document.getElementById("login-password"),i=e.value.trim(),s=t.value.trim();if(!i||!s)return b("Por favor, preencha o usuário e a senha.");N(!0);try{const e=r(),t=await fetch("/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:i,password:s,deviceToken:e})}),a=await t.json();if(!t.ok)throw 403===t.status&&a.deviceToken&&m(a.deviceToken),new Error(a.message);n(a.sessionToken),d(a.username),c(a.codusu),m(a.deviceToken),k("main"),D(),z.start(),await p()}catch(u){a(),o(),l(),b(u.message,"Falha no Login")}finally{N(!1),t.value=""}}async function g(e=!1){P();if(t())try{await u("/logout")}catch(n){}a(),o(),l(),z.clear(),H.forEach(e=>window.removeEventListener(e,O)),k("login"),e&&b("Sua sessão expirou por inatividade.","Sessão Expirada")}async function p(){N(!0);try{const e=await u("/get-warehouses"),t=document.getElementById("armazem-select"),n=document.getElementById("modal-armdes-transfer");t.innerHTML='<option value="">Selecione um Armazém</option>',n.innerHTML="",e.forEach(e=>{const[a,i]=e,d=document.createElement("option");d.value=a,d.textContent=i,t.appendChild(d),n.appendChild(d.cloneNode(!0))})}catch(e){b(e.message,"Erro ao carregar Armazéns")}finally{N(!1)}}async function y(){N(!0),document.getElementById("results-container").innerHTML="",document.getElementById("empty-state").classList.add("hidden");try{const t=document.getElementById("armazem-select").value;if(!t)throw new Error("Por favor, selecione um armazém para iniciar a busca.");const n=document.getElementById("filtro-sequencia").value;!function(t){const n=document.getElementById("results-container"),a=document.getElementById("empty-state");if(n.innerHTML="",!t||0===t.length)return a.classList.remove("hidden"),void(a.querySelector("span").textContent="Nenhum resultado encontrado para esta busca.");a.classList.add("hidden"),t.forEach(t=>{const[a,i,d,o,s,c,l,r,m,v,g]=t,p=document.createElement("div");p.className="result-card","S"===v&&p.classList.add("picking-area");let y=c||"Sem descrição";l&&(y+=` - ${l}`),p.innerHTML=`<div class="card-header"><p>Seq: <span>${a}</span></p><p>Rua: <span>${i}</span></p><p>Prédio: <span>${d}</span></p></div><div class="card-body"><p class="product-desc">${y}</p></div><div class="card-footer"><span class="product-code">Cód: ${s}</span><span class="product-quantity">Qtd: <strong>${g}</strong></span><span class="product-validity">Val: ${B(r)}</span></div>`,p.addEventListener("click",()=>async function(t){N(!0);try{const n=document.getElementById("armazem-select").value;!function(t){const[n,a,i,d,o,s,c,l,r,m,u,v]=t;e={codarm:n,sequencia:a,rua:i,predio:d,apto:o,codprod:s,descrprod:c,marca:l,datval:r,quantidade:m,endpic:u,qtdCompleta:v};const g=document.getElementById("details-content"),p="S"===u?"picking-area":"";g.innerHTML=`<div class="detail-hero ${p}"><h3 class="product-desc">${c||"Produto sem descrição"}</h3><div class="product-code">Cód. Prod.: ${s}</div></div><div class="details-section"><h4 class="details-section-title">Informações</h4><div class="details-grid"><div class="detail-item"><div class="label">Marca</div><div class="value">${l||"N/A"}</div></div><div class="detail-item"><div class="label">Validade</div><div class="value">${B(r)}</div></div><div class="detail-item"><div class="label">Quantidade</div><div class="value">${v||0}</div></div></div></div><div class="details-section"><h4 class="details-section-title">Localização</h4><div class="details-grid"><div class="detail-item"><div class="label">Armazém</div><div class="value">${n}</div></div><div class="detail-item"><div class="label">Rua</div><div class="value">${i}</div></div><div class="detail-item"><div class="label">Prédio</div><div class="value">${d}</div></div><div class="detail-item"><div class="label">Sequência</div><div class="value">${a}</div></div><div class="detail-item"><div class="label">Apto</div><div class="value">${o}</div></div></div></div>`}(await u("/get-item-details",{codArm:n,sequencia:t})),k("details")}catch(n){b(n.message,"Erro")}finally{N(!1)}}(a)),n.appendChild(p)})}(await u("/search-items",{codArm:t,filtro:n}))}catch(t){b(t.message,"Erro na Consulta")}finally{N(!1)}}async function f(){P(),N(!0),k("history");try{!function(e){const t=document.getElementById("history-container"),n=document.getElementById("history-empty-state");if(t.innerHTML="",!e||0===e.length)return void n.classList.remove("hidden");n.classList.add("hidden"),e.forEach(e=>{const[n,a,i,d,o,s,c,l]=e,r=document.createElement("div");r.className="history-card";let m=l?`<div class="product-info">${l}<span class="product-code">Cód: ${c}</span></div>`:"",u="";u=o&&s?`<div class="history-movement"><div class="origin"><div class="label">Origem</div><div>${i} &rarr; ${d}</div></div><span class="material-icons arrow">trending_flat</span><div class="destination"><div class="label">Destino</div><div>${o} &rarr; ${s}</div></div></div>`:`<div class="history-location"><div class="location"><div class="label">Local da Baixa</div><div>${i} &rarr; ${d}</div></div></div>`,r.innerHTML=`<div class="card-header"><p>Operação: <span>${n}</span></p><p>${a}</p></div><div class="card-body">${m}${u}</div>`,t.appendChild(r)})}(await u("/get-history"))}catch(e){b(e.message,"Erro ao carregar Histórico"),k("main")}finally{N(!1)}}async function E(){const t=parseInt(document.getElementById("modal-qtd-baixa").value,10);if(isNaN(t)||t<=0||t>e.quantidade)return b("Quantidade para baixa é inválida.");S(),N(!0);try{const n={codarm:e.codarm,sequencia:e.sequencia,quantidade:t};b((await u("/execute-transaction",{type:"baixa",payload:n})).message,"Sucesso!"),k("main"),await y()}catch(n){b(n.message,"Falha na Baixa")}finally{N(!1)}}async function h(){const t=parseInt(document.getElementById("modal-qtd-transfer").value,10),n=document.getElementById("modal-armdes-transfer").value,a=document.getElementById("modal-enddes-transfer").value.trim();if(isNaN(t)||t<=0||t>e.quantidade)return b("Quantidade inválida.");if(!n)return b("Selecione um armazém de destino.");if(!a)return b("Insira o endereço de destino.");T(),N(!0);try{const i={origem:e,destino:{armazemDestino:n,enderecoDestino:a,quantidade:t}};b((await u("/execute-transaction",{type:"transferencia",payload:i})).message,"Sucesso!"),k("main"),await y()}catch(i){b(i.message,"Falha na Transferência")}finally{N(!1)}}async function I(){const t=parseInt(document.getElementById("modal-qtd-picking").value,10),n=document.getElementById("modal-seqend-picking").value;if(isNaN(t)||t<=0||t>e.quantidade)return b("Quantidade inválida.");if(!n)return b("Selecione um endereço de destino.");x(),N(!0);try{const a={origem:e,destino:{armazemDestino:e.codarm.toString(),enderecoDestino:n,quantidade:t}};b((await u("/execute-transaction",{type:"picking",payload:a})).message,"Sucesso!"),k("main"),await y()}catch(a){b(a.message,"Falha na Operação de Picking")}finally{N(!1)}}async function L(){if(!e)return;document.getElementById("modal-qtd-disponivel-picking").textContent=e.qtdCompleta;const t=document.getElementById("modal-qtd-picking");t.value=e.quantidade,t.max=e.quantidade;const n=document.getElementById("modal-seqend-picking");n.innerHTML='<option value="">Buscando locais...</option>',n.disabled=!0,document.getElementById("picking-modal").classList.remove("hidden"),N(!0);try{const{codarm:t,codprod:a,sequencia:i}=e,d=await u("/get-picking-locations",{codarm:t,codprod:a,sequencia:i});n.innerHTML=d.length?'<option value="">Selecione um destino</option>':'<option value="">Nenhum local de picking encontrado</option>',d.forEach(([e,t])=>{const a=document.createElement("option");a.value=e,a.textContent=`${e} - ${t}`,n.appendChild(a)}),n.disabled=!1}catch(a){b(a.message,"Erro"),x()}finally{N(!1)}}function B(e){if(!e||"string"!=typeof e)return"";const t=e.split(" ")[0];return 8!==t.length?e:`${t.substring(0,2)}/${t.substring(2,4)}/${t.substring(4,8)}`}function k(e){document.querySelectorAll("#app-container .page").forEach(e=>e.classList.remove("active"));const t=document.getElementById("login-page"),n=document.getElementById("app-container");if("login"===e)t.classList.remove("hidden"),n.classList.add("hidden");else{t.classList.add("hidden"),n.classList.remove("hidden");const a=document.getElementById(`${e}-page`);a&&a.classList.add("active")}}function b(e,t="Aviso"){document.getElementById("modal-confirm-title").textContent=t,document.getElementById("modal-confirm-message").innerHTML=e,document.getElementById("confirm-modal").classList.remove("hidden")}function q(){document.getElementById("confirm-modal").classList.add("hidden")}function $(){if(!e)return;document.getElementById("modal-qtd-disponivel").textContent=e.qtdCompleta;const t=document.getElementById("modal-qtd-baixa");t.value=e.quantidade,t.max=e.quantidade,document.getElementById("baixa-modal").classList.remove("hidden")}function S(){document.getElementById("baixa-modal").classList.add("hidden")}function w(){if(!e)return;document.getElementById("modal-qtd-disponivel-transfer").textContent=e.qtdCompleta;const t=document.getElementById("modal-qtd-transfer");t.value=e.quantidade,t.max=e.quantidade,document.getElementById("modal-enddes-transfer").value="",document.getElementById("transfer-modal").classList.remove("hidden")}function T(){document.getElementById("transfer-modal").classList.add("hidden")}function x(){document.getElementById("picking-modal").classList.add("hidden")}const C=document.getElementById("loading");function N(e){C.classList.toggle("hidden",!e)}function M(){document.getElementById("profile-overlay").classList.remove("hidden"),document.getElementById("profile-panel").classList.add("active"),document.getElementById("profile-user-info").textContent=`${s()} - ${i()}`,document.getElementById("session-hash").textContent=t()}function P(){document.getElementById("profile-overlay").classList.add("hidden"),document.getElementById("profile-panel").classList.remove("active")}const z={timeoutID:null,timeoutInMilliseconds:36e5,start:function(){this.clear(),this.timeoutID=setTimeout(()=>this.forceLogout(),this.timeoutInMilliseconds)},reset:function(){this.start()},clear:function(){this.timeoutID&&clearTimeout(this.timeoutID)},forceLogout:function(){g(!0)}},H=["mousemove","mousedown","keypress","scroll","touchstart"];let A=null;const O=()=>{A||(A=setTimeout(()=>{z.reset(),A=null},500))};function D(){H.forEach(e=>window.addEventListener(e,O))}document.addEventListener("DOMContentLoaded",()=>{document.getElementById("btn-login").addEventListener("click",v),document.getElementById("login-password").addEventListener("keyup",e=>"Enter"===e.key&&v()),document.getElementById("btn-logout").addEventListener("click",()=>g(!1)),document.getElementById("btn-consultar").addEventListener("click",y),document.getElementById("filtro-sequencia").addEventListener("keyup",e=>"Enter"===e.key&&y()),document.getElementById("btn-voltar").addEventListener("click",()=>k("main")),document.getElementById("btn-history-voltar").addEventListener("click",()=>k("main")),document.querySelector(".btn-baixar").addEventListener("click",$),document.querySelector(".btn-transferir").addEventListener("click",w),document.querySelector(".btn-picking").addEventListener("click",L),document.getElementById("btn-confirmar-baixa").addEventListener("click",E),document.getElementById("btn-confirmar-transfer").addEventListener("click",h),document.getElementById("btn-confirmar-picking").addEventListener("click",I),document.getElementById("btn-cancelar-baixa").addEventListener("click",S),document.getElementById("btn-cancelar-transfer").addEventListener("click",T),document.getElementById("btn-cancelar-picking").addEventListener("click",x),document.getElementById("btn-close-confirm").addEventListener("click",q),document.getElementById("btn-open-profile").addEventListener("click",M),document.getElementById("btn-close-profile").addEventListener("click",P),document.getElementById("profile-overlay").addEventListener("click",P),document.getElementById("btn-history").addEventListener("click",f),t()?(k("main"),D(),z.start(),p()):k("login")});
